## Supportability

The supportability tool collects Mayastor specific information from the cluster using the [kubectl plugin](https://mayastor.gitbook.io/introduction/v/develop/reference/kubectl-plugin) command-line tool. It uses the dump command, which interacts with the Mayastor services to build an archive (ZIP) file that acts as a placeholder for the bundled information.


### Using the supportability tool

To bundle Mayastor's complete system information, execute:

{% tab title="Command" %}
```text
kubectl mayastor dump system -n mayastor -d <output_directory_path>
```
{% endtab %}

{% hint style="info" %}
**Note:** If the nodes exist on a private network or the node ports are not exposed to an outside cluster, all the above commands need to pass these additional parameters:
kubectl mayastor dump <resource> -d <output_directory> -r http://127.0.0.1:30011 -l http://127.0.0.1:3100 -e http://127.0.0.1:2379 -n mayastor
{% endhint %}


To view all the available options and sub-commands that can be used with the dump command, execute:

{% tabs %}
{% tab title="Command" %}
```text
kubectl mayastor dump --help
```
{% endtab %}
{% tab title="Sample Output" %}
```text
kubectl-mayastor-dump 
`Dump` resources

USAGE:
    kubectl-mayastor dump [OPTIONS] <SUBCOMMAND>

OPTIONS:
    -d, --output-directory-path <OUTPUT_DIRECTORY_PATH>
            Output directory path to store archive file [default: ./]

    -e, --etcd-endpoint <ETCD_ENDPOINT>
            Endpoint of ETCD service, if left empty then will be parsed from the internal service
            name

    -h, --help
            Print help information

    -j, --jaeger <JAEGER>
            Trace rest requests to the Jaeger endpoint agent

    -k, --kube-config-path <KUBE_CONFIG_PATH>
            Path to kubeconfig file

    -l, --loki-endpoint <LOKI_ENDPOINT>
            Endpoint of LOKI service, if left empty then it will try to parse endpoint from Loki
            service(K8s service resource), if the tool is unable to parse from service then logs
            will be collected using Kube-apiserver

    -n, --namespace <NAMESPACE>
            Kubernetes namespace of mayastor service, defaults to mayastor [default: mayastor]

    -o, --output <OUTPUT>
            The Output, viz yaml, json [default: none]

    -r, --rest <REST>
            The rest endpoint to connect to

    -s, --since <SINCE>
            Period states to collect all logs from last specified duration [default: 24h]

    -t, --timeout <TIMEOUT>
            Specifies the timeout value to interact with other modules of system [default: 10s]

SUBCOMMANDS:
    etcd       Collects information from etcd
    help       Print this message or the help of the given subcommand(s)
    node       Collects information about particular node matching to given node ID
    nodes      Collects information about all nodes
    pool       Collects information about particular pool and its descendants matching to given
                   pool ID
    pools      Collects information about all pools and its descendants (nodes)
    system     Collects entire system information
    volume     Collects information about particular volume and its descendants matching to
                   given volume ID
    volumes    Collects information about all volumes and its descendants (replicas/pools/nodes)

Supportability - collects state & log information of services and dumps it to a tar file.
```
{% endtab %}
{% endtabs %}

{% hint style="info" %}
**Note:** The information collected by the supportability tool is solely used for debugging purposes. The content of these files is human-readable and can be reviewed, deleted, or redacted as necessary to adhere to the organization's data protection/privacy commitments and security policies before transmitting the bundles.
Please refer to the section: ['Does the supportability tool expose sensitive data'](https://mayastor.gitbook.io/introduction/v/develop/quickstart/faqs#does-the-supportability-tool-expose-sensitive-data) to get more details.
{% endhint %}


The archive files generated by the dump command are stored in the specified output directories. The tables below specify the path and the content that will be stored in each archive file.


<details>
<summary>Topology Information</summary>
| Folder Path | Mayastor Resource | Node Name |  File Name | Description |
| :--- | :--- | :--- | :--- | :--- |
| ./topology/node | node | node-01 | node-01-topology.json | Topology of node-01(All node topologies will available here) |
| ./topology/pool | pool | pool-01 | pool-01-topology.json | Topology of pool-01 (All pool topologies will available here) |
| ./topology/volume | volume | volume-01 | volume-01-topology.json | Topology information of volume-01 (All volume topologies will available here) |
</details>

<details>
<summary>Historical Logs</summary>
| Folder Path | Host Name(optional) | Component | File Name |
| :--- | :--- | :--- | :--- |
| ./logs/core-agents | - | agent-core | loki-agent-core.log |
| ./logs/rest | - | api-rest | loki-api-rest.log |
| ./logs/csi-controller | - | csi-attacher | loki-csi-attacher.log |
| ./logs/csi-controller | - | csi-controller | loki-csi-controller.log |
| ./logs/csi-controller | - | 	csi-provisioner | loki-csi-provisioner.log |
| ./logs/diskpool-operator | - | operator-diskpool | loki-operator-disk-pool.log |
| ./logs/mayastor| 	node-02 | csi-driver-registrar | node-02-loki-csi-driver-registrar.log |
| ./logs/mayastor | node-01 | csi-node | node-01-loki-csi-node.log |
| ./logs/mayastor | node-01	 | io-engine | node-01-loki-mayastor.log |
| ./logs/blot | node-02 | io-engine | node-02-loki-mayastor.log |
| ./logs/etcd | node-03 | etcd | node-03-loki-etcd.log |
</details> 

<details>
<summary>Configuration details of Kubernetes resources</summary>
| Folder Path | Component | File Name |
| :--- | :--- | :--- |
| ./k8s_resources/configurations/ | agent-core (Deployment) | mayastor-agent-core.yaml |
| ./k8s_resources/configurations/ | api-rest | mayastor-api-rest.yaml |
| ./k8s_resources/configurations/ | csi-controller (Deployment) | mayastor-csi-controller.yaml |
| ./k8s_resources/configurations/ | csi-node(Daemonset) |  mayastor-csi-node.yaml |
| ./k8s_resources/configurations/ | etcd (Statefullset) | mayastor-etcd.yaml |
| ./k8s_resources/configurations/ | loki (Statefullset) | mayastor-loki-yaml |
| ./k8s_resources/configurations/ | operator-diskpool | mayastor-operator-disk-pool.yaml |
| ./k8s_resources/configurations/ | promtail(Daemonset) | mayastor-promtail.yaml |
| ./k8s_resources/configurations/ | io-engine (Daemonset) | io-engine.yaml |
| ./k8s_resources/configurations/ | disk_pools | k8s_diskPools.yaml |
| ./k8s_resources/configurations/ | events | k8s_events.yaml |
| ./k8s_resources/configurations/ | all pods(deployed under the same namespace as Mayastor) | pods.yaml |
</details>

<details>
<summary>etcd dump information</summary>
| Folder Path | Component | File Name |
| :--- | :--- | :--- |
| ./ | etcd | etcd_dump |
</details>

<details>
<summary>Supportability tool logs</summary>
| Folder Path | Component | File Name |
| :--- | :--- | :--- |
| ./ | 	Support-tool | support_tool_logs.log |
</details>
 